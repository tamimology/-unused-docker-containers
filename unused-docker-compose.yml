#
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# DATABASES
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# 6378            - 2FAuth-Redis                     Used for 2FAuth                                                redis:alpine
# -               - Chatvault-Postgres               Used for Chatvault                                             postgres:alpine
# -               - JoplinDB                         Used for Joplin                                                postgres:13.1
# 27017           - Our Shopping List-DB             Used for Our Shopping List                                     mongo:4.0
# 3300            - phpMyAdmin                       UI interface to view self-hosted DBs                           phpmyadmin/phpmyadmin:latest
# 4100            - Phlare                           Continuous observability for workload's resources              grafana/phlare:latest
# -               - Photoview-Postgress              Used for Photoview                                             postgres:alpine
# -               - Piped-Postgres                   Used for Piped                                                 postgres:alpine
# -               - Piwigo-DB                        Used for Piwigo                                                vcxpz/mariadb:latest
# 9090            - Prometheus                       Systems and service monitoring system                          prom/prometheus:latest
#
#
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# DOCKER RELATED
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# 9093            - AlertManager                     Handles alerts sent by client applications (Prometheus)        prom/alertmanager:latest
# -               - Autoheal                         Monitor and restart unhealthy docker containers                modem7/docker-autoheal:latest
# 7020            - BroadLinkManager                 Helps to work with Broadlink Devices                           techblog/broadlinkmanager:latest
# 8888            - cAdvisor                         Analyzes resource usage and performance of running containers  gcr.io/cadvisor/cadvisor:latest
# 8722            - CheckMK                          Powerful monitoring of networks, servers, containers           checkmk/check-mk-raw:latest
# -               - Container-Mon                    Get notified when a Docker containers are unhealthy            ghcr.io/rafhaanshah/container-mon:latest
# 4321            - DeCompose                        Generates docker-compose file from existing containers         techblog/decompose:latest
# -               - DeUnHealth                       Restarts unhealthy containers                                  qmcgaw/deunhealth:latest
# 6001            - DockGE                           Easy-to-use self-hosted docker compose.yaml manager            louislam/dockge:1
# 61208           - Glances                          Cross-platform monitoring tool                                 joweisberg/glances:latest
# 9091            - Node-Exporter                    Prometheus exporter for machine metrics                        prom/node-exporter:latest
# -               - Ouroboros                        Update containers with latest images                           pyouroboros/ouroboros:latest
# 9000,9443,8000  - Portainer-CE                     Docker management tool (FREE Community Edition)                portainer/portainer-ce:alpine
# 2376            - TLS-Socket-Proxy                 A security-enhanced proxy for the Docker Socket with TLS       sjawhar/docker-socket-proxy:latest
# 8818,8090       - WebTTY                           Container WebTTY terminal access                               wrfly/container-web-tty:0.1.10
# 3000            - WhatsUpDocker                    Same as WatchTower but with UI and actions                     fmartinou/whats-up-docker:latest
#
#
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# LINKS / PAGE ORGANISATION
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# 5050            - DashMachine                      Links manager                                                  rmountjoy/dashmachine:latest
# 18080           - Shiori                           A simple bookmarks manager                                     ghcr.io/go-shiori/shiori:latest
#
#
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# MEDIA PLAYING
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# 8096            - Emby                             Media server                                                   emby/embyserver:latest
# 6555            - EmbyStat                         Stat web interface for Emby Media server                       uping/embystat:beta-linux-x64
# 9494            - Reiverr                          A single UI interacting with TMDB, Jellyfin, Radarr and Sonarr ghcr.io/aleksilassila/reiverr:latest
# 6556            - Jellyseerr                       Managing requests for media library                            fallenbagel/jellyseerr:latest
# 32400           - Plex Media Server                Media server (standby)                                         plexinc/pms-docker:latest
#
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# NETWORKING & SECURITY
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# 80, 3000        - AdGuardHome                      Network-wide software for blocking ads & tracking              adguard/adguardhome:latest
# 3006            - AdGuard-Sync                     Synchronize AdGuardHome config to replica instances            ghcr.io/bakito/adguardhome-sync:latest
# -               - CloudFlare DDNS                  Dynamic DNS updater for CloudFlare Tunnel                      oznu/cloudflare-ddns:latest
# 8002            - DDNS Updater                     Dynamic DNS updater for mulit-DDNS services in one             qmcgaw/ddns-updater:latest
# 10000,67        - DHCPdns                          A DHCPdns with Webmin GUI to assign static IPs                 mayankt/dhcpdns:latest
# 9090            - Doku                             Monitor docker disk usage in a user-friendly manner            amerkurev/doku:latest
# -               - DuckDNS                          Dynamic DNS updater for DuckDNS                                maksimstojkovic/duckdns:latest
# -               - Fail2Ban                         Blockes IPs of Brute Force logins 'for Authelia'               crazymax/fail2ban:latest
# 7880            - GoAccess                         Parse proxy logs for Nginx Proxy Manager                       xavierh/goaccess-for-nginxproxymanager:latest
# -               - Kea                              A DHCP server to assign static IPs (no UI)                     jonasal/kea-dhcp4:2
# -               - Let's Encrypt                    Auto HTTPS certificate generator from Let's Encrypt            maksimstojkovic/letsencrypt:latest
# 404             - MiddleFinger                     Shows a dual 00100 hands for any unauthorised access           modem7/middle-finger:dual
# 881,880,843     - Nginx Proxy Manager              Reverse proxy manager                                          jc21/nginx-proxy-manager:latest
# 1339            - SnipeIT                          Open source IT asset management system                         snipe/snipe-it:latest-alpine
# 8888            - WebDAV                           Access local files using WebDAV                                bytemark/webdav:latest
# 6543            - webNUT                           UPS network monitoring web ui                                  edgd1er/webnut:latest

#
#
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# PROGRAMMING
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# 6060            - AppDaemon                        sandboxed python execution environment for HomeAssistant       acockburn/appdaemon:latest
# 5545            - IT-Tools                         Useful tools for developer and people working in IT            corentinth/it-tools:latest
# 1880            - Node-Red                         Develop code for linking smart devices                         nodered/node-red:latest
# 8181            - Visual Studio Code               Code editor                                                    codercom/code-server:latest
#
#
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# SYSTEM MONITORING & MANAGEMENT
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# 8234            - Home-Panel                       Web frontend for controlling the home                          timmo001/home-panel:latest
#
#
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# SELF-HOSTED
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# 8010            - 2FAuth                           2FAuth OTP Generator                                           2fauth/2fauth:latest
# 8787            - Chatvault                        Stores backups of WhatsApp conversations from various sources  ghcr.io/vitormarcal/chatvault:latest
# 9988            - Collabora                        Editing documents in a browser from supported applications     tiredofit/collabora-online:latest
# 4688            - Dufs                             Utility file server that supports webdav                       sigoden/dufs:latest
# 8053            - FlatNotes                        A database-less note-taking web app                            dullage/flatnotes:latest
# 3332,223        - Forgejo                          A self-hosted lightweight software forge                       codeberg.org/forgejo/forgejo:1.21
# 2300            - Joplin                           Open source note taking and to-do application                  joplin/server:latest
# 4480,4443       - KanBoard                         Kanban Board                                                   kanboard/kanboard:latest
# 5230            - Memos                            Capture and share your great thoughts                          neosmemo/memos:latest
# 8245            - LibreX                           Free privacy respecting meta search engine Google Alternative  librex/librex:latest
# 7821            - LibreTranslate                   Open Source Machine Translation API                            libretranslate/libretranslate:latest
# 6455            - Lingva-Translate                 Alternative front-end for Google Translate                     thedaviddelta/lingva-translate:latest
# 8989            - Our Shopping List                A simple shared shopping list application                      nanawel/our-shopping-list:latest
# 2342            - Photoprism                       AI-Powered Photos App for the Decentralized Web                photoprism/photoprism:latest
# 7354            - Photoview                        A simple and user-friendly Photo Gallery                       viktorstrate/photoview:2
# 8179            - PicoShare                        Minimalist service to share files easily                       mtlynch/picoshare:latest
# 9842            - Pigallery                        A self-hosted directory-first photo gallery website            bpatrik/pigallery2:latest
# -               - Piped-Backend                    An advanced open-source privacy alternative to YouTube         1337kavin/piped:latest
# -               - Piped-Frontend                   A front UI for Piped-Backeend                                  1337kavin/piped-frontend:latest
# 7601            - Piped-Nginx                      Redirects all Youtube to Piped-Backend                         nginx:mainline-alpine
# -               - Piped-Proxy                      A proxy for Piped-Backend                                      1337kavin/piped-proxy:latest
# 8100            - Piwigo                           Photos/videos managing with face recognition                   ghcr.io/linuxserver/piwigo:latest
# 5080            - SearXNG                          Privacy-respecting, hackable metasearch engine                 searxng/searxng:latest
# 8205            - Vault                            A tool for secrets management                                  hashicorp/vault:latest
# 8522,4443       - xBackbone                        A lightweight file manager with full ShareX support            lscr.io/linuxserver/xbackbone:latest
#
# -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#
#
services:
#
####################################################
#                                                  #
#                -------2FAuth-------              #
#                                                  #
####################################################
#
  2fauth:
    container_name: 2fauth
    restart: $RESTART_POLICY
    hostname: 2fauth
    environment:
      - APP_NAME=Tamimology Server 2FAuth
      - APP_ENV=local
      - APP_DEBUG=false
      - SITE_OWNER=$GM_USER
      - APP_KEY=$APP_KEY
      - APP_URL=https://2fauth.$DOMAINNAME
      - IS_DEMO_APP=false
      - LOG_CHANNEL=daily
      - APP_LOG_LEVEL=notice # debug, info, notice, warning, error, critical, alert, emergency
      - DB_CONNECTION=sqlite #can only be sqlite
      - DB_DATABASE="/srv/database/database.sqlite"
      # If you're looking for performance improvements, you could install memcached.
      - CACHE_DRIVER=file
      - SESSION_DRIVER=file
      - FILESYSTEM_DRIVER=local
      - MAIL_DRIVER=log
      - MAIL_HOST=$GM_HOST
      - MAIL_PORT=$GM_PORT
      - MAIL_FROM=$GM_USER
      - MAIL_USERNAME=$GM_USER
      - MAIL_PASSWORD=$GM_PSW
      - MAIL_ENCRYPTION=null
      - MAIL_FROM_NAME=2FAuth
      - MAIL_FROM_ADDRESS=$GM_USER
      - AUTHENTICATION_GUARD=web-guard
      - AUTH_PROXY_HEADER_FOR_USER=null
      - AUTH_PROXY_HEADER_FOR_EMAIL=null
      - WEBAUTHN_NAME=Tamimology Server 2FAuth
      - WEBAUTHN_ID=null
      - WEBAUTHN_ICON=null
      - WEBAUTHN_USER_VERIFICATION=preferred
      - TRUSTED_PROXIES=null  # * to trust any proxy, or a comma separated IP list
      - BROADCAST_DRIVER=log
      - QUEUE_DRIVER=sync
      - SESSION_LIFETIME=12
      - REDIS_HOST=2fauth-redis
      - REDIS_PASSWORD=null
      - REDIS_PORT=6378
      - MIX_ENV=local
      #- PUSHER_APP_ID=
      #- PUSHER_APP_KEY=
      #- PUSHER_APP_SECRET=
      #- PUSHER_APP_CLUSTER=mt1
      #- MIX_PUSHER_APP_KEY="${PUSHER_APP_KEY}"
      #- MIX_PUSHER_APP_CLUSTER="${PUSHER_APP_CLUSTER}"
    volumes:
      - $PERSIST/2fauth:/2fauth
    ports:
      - 8010:8000/tcp
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    depends_on:
      - 2fauth-redis
    image: '2fauth/2fauth:3.0.2' #latest'
#
####################################################
#                                                  #
#             -------2FAuth-Redis------            #
#                                                  #
####################################################
#
  2fauth-redis:
    container_name: 2fauth-redis
    restart: $RESTART_POLICY
    hostname: 2fauth-redis
    environment:
      - TZ=$TZ
    volumes:
      - $PERSIST/2fauth/redis:/data
    expose:
      - 6378
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    image: 'redis:alpine'
#
####################################################
#                                                  #
#              -------AdGuard-------               #
#                                                  #
####################################################
#
# a good source for blocklists
# https://oisd.nl/?p=dl
# https://github.com/AdguardTeam/AdGuardHome/issues/1325
#
#
  adguard:
    container_name: adguard
    restart: $ALWAYS_ON_POLICY
    hostname: adguard
    environment:
      - TZ=$TZ
    volumes:
      - $PERSIST/adguard/conf:/opt/adguardhome/conf 
      - $PERSIST/adguard/work:/opt/adguardhome/work 
      - $PERSIST/adguard/certs:/certs
    ports:
      - 53/udp 
      - 67/udp 
      - 68/tcp 
      - 68/udp 
      - 80/tcp 
      - 443/tcp 
      - 853/tcp 
      - 3000/tcp 
    networks:
      my_bridge:
        ipv4_address: $BRIDGE_NET.202
      dockervlan:
        ipv4_address: $MACVLAN_NET.9
    security_opt:
      - no-new-privileges:true
    labels: 
      autoheal: $AUTOHEAL_RESTART
      monocker.enable: $MONOCKER_ENABLE
    image: 'adguard/adguardhome:latest'
#
####################################################
#                                                  #
#             -------AdGuard-Sync-------           #
#                                                  #
####################################################
#
  adguard-sync:
    container_name: adguard-sync
    restart: $ALWAYS_ON_POLICY
    hostname: adguard-sync
    command: run --config /config/adguardhome-sync.yaml
    environment:
      - LOG_LEVEL=info
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
    volumes:
      - $PERSIST/adguard/sync/adguardhome-sync.yaml:/config/adguardhome-sync.yaml
    networks:
      my_bridge:
      dockervlan:
        ipv4_address: $MACVLAN_NET.7 #must be in the same macvlan as original instance
    labels: 
      autoheal: $AUTOHEAL_RESTART
      monocker.enable: $MONOCKER_ENABLE
    ports:
      - 3006:8080
    image: 'ghcr.io/bakito/adguardhome-sync:latest'
#
####################################################
#                                                  #
#              -------AlertManager-------          #
#                                                  #
####################################################
#
# for Prometheus
#
  alertmanager:
    container_name: alertmanager
    restart: $ALWAYS_ON_POLICY
    hostname: alertmanager
    volumes:
      - $PERSIST/alertmanager/:/etc/alertmanager/
    ports:
      - 9093:9093
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    command:
      - '--config.file=/etc/alertmanager/config.yml'
      - '--storage.path=/alertmanager'
    image: 'prom/alertmanager:latest'
#
####################################################
#                                                  #
#            -------AndroidTV ADB-------           #
#                                                  #
####################################################
#
  androidtv-adb:
    container_name: androidtv-adb
    restart: $ALWAYS_ON_POLICY
    hostname: androidtv-adb
    volumes:
     - $PERSIST/adb/config:/config
     - $LOCAL_TIME:/etc/localtime:ro
    ports:
     - 5037:5037
    networks:
      my_bridge:
    command: sh -c "/config/startup.sh & adb -a -P 5037 server nodaemon"
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    image: 'sorccu/adb:latest'
#
####################################################
#                                                  #
#              -------AppDaemon-------             #
#                                                  #
####################################################
#
  appdaemon:
    container_name: appdaemon
    restart: $ALWAYS_ON_POLICY
    hostname: appdaemon
    environment:
        - HA_URL=http://$LOCAL_HOST:8123
        - TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiIxNjY2ZWMwZGI4YWE0MTYwODQ5NDYzMWEyNWY5ODAzMyIsImlhdCI6MTY4ODQ1ODUyMSwiZXhwIjoyMDAzODE4NTIxfQ.PEsdgMBC0Oc2Zl9Wl2VYPY2LGKzqvO02XxkkeQSnfL8
        - DASH_URL=http://$LOCAL_HOST:6060
    volumes:
        - $PERSIST/appdaemon:/conf'
    ports:
        - 6060:5050
    networks:
      my_bridge:
    image: 'acockburn/appdaemon:latest'
#
####################################################
#                                                  #
#             -------Auto-Heal-------              #
#                                                  #
####################################################
#
  autoheal:
    container_name: autoheal
    restart: $ALWAYS_ON_POLICY
    hostname: autoheal
    environment:
      - AUTOHEAL_CONTAINER_LABEL=autoheal #all
      - DOCKER_SOCK=$DOCKER_HOST
      - APPRISE_URL=http://$LOCAL_HOST:8001/notify/autoheal
      - AUTOHEAL_INTERVAL=5   # check every 5 seconds
      - AUTOHEAL_START_PERIOD=600   # wait 10 minutes before first health check
      - AUTOHEAL_DEFAULT_STOP_TIMEOUT=60   # Docker waits max 10 seconds (the Docker default) for a container to stop before killing during restarts (container overridable via label, see below)
      - CURL_TIMEOUT=30     # --max-time seconds for curl requests to Docker API
      # - POST_RESTART_SCRIPT=""    # Run the specified script if a container was re
    volumes:
      - $LOCAL_TIME:/etc/localtime:ro
    networks:
      my_bridge:
    image: 'modem7/docker-autoheal:latest' # 'willfarrell/autoheal:latest'
#
####################################################
#                                                  #
#           -------BroadLinkManager-------         #
#                                                  #
####################################################
#
  broadlinkmanager:
    container_name: broadlinkmanager
    restart: $RESTART_POLICY
    hostname: broadlinkmanager
    environment:
      - ENABLE_GOOGLE_ANALYTICS=False #Optional, default is True, Set to False if you want to disable Google Analytics
    volumes:
      - $PERSIST/broadlinkmanager:/opt/broadlinkmanager/data
    ports:
      - 7020:7020
    # networks:
    #   my_bridge:
    network_mode: host
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    image: 'techblog/broadlinkmanager:latest'
#
####################################################
#                                                  #
#               -------cAdvisor-------             #
#                                                  #
####################################################
#
  cadvisor:
    container_name: cadvisor
    restart: $RESTART_POLICY
    hostname: cadvisor
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:ro
      - /volume1/@docker:/var/lib/docker:ro # USE IN SSH TO GET IT ( docker info | grep "Docker Root Dir:" )
      - /dev:/dev:ro

      - /sys/fs/cgroup/cpu:/sys/fs/cgroup/cpu:ro

      # - /sys/fs/cgroup/cpuset:/sys/fs/cgroup/cpuset:ro

      - /sys/fs/cgroup/cpuacct/docker:/sys/fs/cgroup/cpuacct:ro
      - /sys/fs/cgroup/cpuacct/cgroup.clone_children:/sys/fs/cgroup/cpuacct/cgroup.clone_children:ro
      - /sys/fs/cgroup/cpuacct/cgroup.event_control:/sys/fs/cgroup/cpuacct/cgroup.event_control:ro
      - /sys/fs/cgroup/cpuacct/cgroup.procs:/sys/fs/cgroup/cpuacct/cgroup.procs:ro
      - /sys/fs/cgroup/cpuacct/cpuacct.stat:/sys/fs/cgroup/cpuacct/cpuacct.stat:ro
      - /sys/fs/cgroup/cpuacct/cpuacct.usage:/sys/fs/cgroup/cpuacct/cpuacct.usage:ro
      - /sys/fs/cgroup/cpuacct/cpuacct.usage_percpu:/sys/fs/cgroup/cpuacct/cpuacct.usage_percpu:ro
      - /sys/fs/cgroup/cpuacct/notify_on_release:/sys/fs/cgroup/cpuacct/notify_on_release:ro
      - /sys/fs/cgroup/cpuacct/tasks:/sys/fs/cgroup/cpuacct/tasks:ro
    privileged: true
    devices:
        - /dev/kmsg
    ports:
      - 8888:8080
    networks:
      my_bridge:        
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    image: 'gcr.io/cadvisor/cadvisor:latest'
#
####################################################
#                                                  #
#              -------ChatVault-------             #
#                                                  #
####################################################
#
  chatvault:
    container_name: chatvault
    restart: $RESTART_POLICY
    hostname: chatvault
    environment:
      - SPRING_DATASOURCE_URL=jdbc:postgresql://chatvault-postgres:5432/chatvaultdb
      - SPRING_DATASOURCE_USERNAME=chatvault
      - SPRING_DATASOURCE_PASSWORD=$DB_PASSWORD
      - CHATVAULT_MSGPARSER_DATEFORMAT="dd/MM/yyyy HH:mm"
      - APP_EMAIL_ENABLED=true
      - APP_EMAIL_HOST=$GM_HOST
      - APP_EMAIL_PASSWORD=$GM_PSW
      - APP_EMAIL_PORT=$GM_PORT
      - APP_EMAIL_USERNAME=$GM_USER
    volumes:
      - $PERSIST/chatvault:/opt/chatvault
      - $PERSIST/chatvault/config:/config
    networks:
      my_bridge:
    ports:
      - 8787:8080
    depends_on:
      - chatvault-postgres
    image: 'ghcr.io/vitormarcal/chatvault:latest'
#
####################################################
#                                                  #
#          -------ChatVault-Postgres-------        #
#                                                  #
####################################################
#
  chatvault-postgres:
    container_name: chatvault-postgres
    restart: $RESTART_POLICY
    hostname: chatvault-postgres
    volumes:
      - $PERSIST/chatvault/db:/var/lib/postgresql/data
    environment:
      TZ: $TZ
      POSTGRES_DB: chatvaultdb
      POSTGRES_USER: chatvault
      POSTGRES_PASSWORD: $DB_PASSWORD
    networks:
      my_bridge:
    security_opt:
      - no-new-privileges:true
    user: $PUID:$PGID
    healthcheck:
      test: ["CMD", "pg_isready", "-q", "-d", "chatvaultdb", "-U", "chatvault"]
      timeout: 45s
      interval: 10s
      retries: 10
    labels: 
      autoheal: $AUTOHEAL_RESTART
    image: 'postgres:alpine'
#
####################################################
#                                                  #
#               -------CheckMK-------              #
#                                                  #
####################################################
#
# check logs for login Username/Password
#
  checkmk:
    container_name: checkmk
    restart: $ALWAYS_ON_POLICY
    hostname: checkmk
    volumes:
      - $PERSIST/checkmk:/omd/sites
      - $LOCAL_TIME:/etc/localtime:ro
    ports:
      - 8722:5000
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    tmpfs: /opt/omd/sites/cmk/tmp:uid=1000,gid=1000
    image: 'checkmk/check-mk-raw:latest'
#
####################################################
#                                                  #
#            -------CloudFlare-DDNS------          #
#                                                  #
####################################################
#
  cloudflare-ddns:
    container_name: cloudflare-ddns
    restart: $ALWAYS_ON_POLICY
    hostname: cloudflare-ddns
    environment:
      - API_KEY=$DDNS_AUTOUPDATE_TOKEN
      - ZONE=tamimology.com
      - PROXIED=true
      - PUID=$PUID
      - PGID=$PGID
    networks:
      my_bridge:
    image: 'oznu/cloudflare-ddns:latest'
#
####################################################
#                                                  #
#              -------Collabora-------             #
#                                                  #
####################################################
#
  collabora:
    image: 'tiredofit/collabora-online:latest'
    container_name: collabora
    # hostname: online.example.com
    cap_add:
      - MKNOD
      - NET_ADMIN
    privileged: true
    # volumes:
    #   - $PERSIST/logs:/logs
    environment:
      - TIMEZONE=$TZ
      - CONTAINER_NAME=collabora
      - ADMIN_USER=admin
      - ADMIN_PASS=collabora-online
      - ALLOWED_HOSTS=localhost
      - ENABLE_TLS=FALSE
      # - ENABLE_TLS_REVERSE_PROXY=TRUE
      - INTERFACE=notebookbar
      - LOG_TYPE=FILE
    ports:
      - 9988:9980
    networks:
      my_bridge:
    restart: always
#
####################################################
#                                                  #
#            -------Container-Mon-------           #
#                                                  #
####################################################
#
  container-mon:
    container_name: container-mon
    restart: $RESTART_POLICY
    hostname: container-mon
    # volumes:
    #   - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - DOCKER_HOST=$DOCKER_HOST
      - CONTAINERMON_CRON=*/1 * * * * # every 1 min
      - CONTAINERMON_FAIL_LIMIT=1
      - CONTAINERMON_USE_LABELS=false #If true will only monitor containers with the label containermon.enable=true set
      - CONTAINERMON_NOTIFICATION_URL=pushover://shoutrrr:$PUSHOVER_DOCKERHEALTH_API@$PUSHOVER_USER_KEY
      - CONTAINERMON_NOTIFY_HEALTHY=true
      - CONTAINERMON_CHECK_STOPPED=false
    networks:
      my_bridge:
    image: 'ghcr.io/rafhaanshah/container-mon:latest'
#
####################################################
#                                                  #
#            -------DashMachine-------             #
#                                                  #
####################################################
#
# iconset from https://fonts.google.com/icons?selected=Material+Icons
#
  dashmachine:
    container_name: dashachine
    restart: $RESTART_POLICY
    hostname: dashmachine
    volumes:
      - $PERSIST/dashmachine:/dashmachine/dashmachine/user_data
    ports:
      - 5050:5000
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    image: 'rmountjoy/dashmachine:latest'
#
####################################################
#                                                  #
#             -------DDNS-Updater-------           #
#                                                  #
####################################################
#
# set the folder and all files in it permission to DOCKER user
# chown -R 1036:100 ddns-updater
#
# set the folder and updates.json in it permission to ROOT
# chown 1000 ddns-updater
# chown 1000 ddns-updater/updates.json
#
#
  ddns-updater:
    container_name: ddns-updater
    restart: $ALWAYS_ON_POLICY
    hostname: ddns-updater
    environment:
      - TZ=$TZ
      - PUID=$PUID
      - PGID=$PGID
      # - USER="0" #run the container as root 
      - PERIOD=5m
      - UPDATE_COOLDOWN_PERIOD=5m
      - PUBLICIP_FETCHERS=all
      - PUBLICIP_HTTP_PROVIDERS=all
      - PUBLICIPV4_HTTP_PROVIDERS=all
      - PUBLICIPV6_HTTP_PROVIDERS=all
      - PUBLICIP_DNS_PROVIDERS=all
      - PUBLICIP_DNS_TIMEOUT=3s
      - HTTP_TIMEOUT=10s
      - LISTENING_PORT=8000
      - HEALTH_SERVER_ADDRESS=127.0.0.1:9999
      - ROOT_URL=/
      - BACKUP_PERIOD=24h # 0 to disable
      - BACKUP_DIRECTORY=/updater/data
      - LOG_LEVEL=info
      - LOG_CALLER=hidden
      - SHOUTRRR_ADDRESSES=pushover://shoutrrr:$PUSHOVER_DDNS_API@$PUSHOVER_USER_KEY
    volumes:
      - $PERSIST/ddns-updater:/updater/data
    networks:
      my_bridge:
    ports:
      - 8002:8000/tcp
    user: $PUID:$PGID
    labels: 
      autoheal: $AUTOHEAL_RESTART
      autoheal.stop.timeout: 30
      monocker.enable: $MONOCKER_ENABLE
    # logging:
    #   driver: loki
    #   options:
    #     loki-url: "http://$LOCAL_HOST:3002/loki/api/v1/push"
    image: 'qmcgaw/ddns-updater:latest'
#
####################################################
#                                                  #
#               -------DeCompose-------            #
#                                                  #
####################################################
#
  decompose:
    container_name: decompose
    restart: $RESTART_POLICY
    hostname: decompose
    environment:
      DOCKER_HOST: $DOCKER_HOST
    # volumes:
    #   - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - 4321:8080
    networks:
      my_bridge:
    # logging:
    #   driver: loki
    #   options:
    #     loki-url: "http://$LOCAL_HOST:3002/loki/api/v1/push"
    image: 'techblog/decompose:latest'
#
####################################################
#                                                  #
#             -------DeUnHealth-------             #
#                                                  #
####################################################
#
  deunhealth:
    container_name: deunhealth
    restart: $RESTART_POLICY
    hostname: deunhealth
    environment:
      - DOCKER_HOST=unix://$DOCKER_SOCKET
      - LOG_LEVEL=info
      - HEALTH_SERVER_ADDRESS=127.0.0.1:9999
      - TZ=$TZ
    volumes:
      - $DOCKER_SOCKET:/var/run/docker.sock
    network_mode: "none"
    image: 'qmcgaw/deunhealth:latest'
#
####################################################
#                                                  #
#                -------DHCPdns-------             #
#                                                  #
####################################################
#
# docker run -it  -p 10000:10000 -p 67:67/udp --network host --name dhcpd -v /volume1/docker/dhcpdns:/data  --cap-add=NET_ADMIN --restart unless-stopped mayankt/dhcpdns
#
# defualt username: admin
# defualt password: Password01
# to have full access using ROOT user, SSH into contianer and execute
# passwd root
# enter {new password} and then login using:
# username: root
# password: {new password}
# DHCP can be found in the Un-used Modules on the left side list
#
  dhcpdns:
    container_name: dhcpdns
    restart: $ALWAYS_ON_POLICY
    hostname: dhcpdns
    privileged: true
    environment:
      - PUID=$PUID
      - PGID=$PGID
    # environment:
    #     - "10000"
    #     - "67/udp"
    volumes:
        - $PERSIST/dhcpdns:/data
        # - $PERSIST/dhcpdns/dhcp/dhcpd.leases:/var/lib/dhcp/dhcpd.leases
        - $PERSIST/dhcpdns/dhcp/dhcpd.conf:/data/dhcp/dhcpd.conf:rw
    network_mode: host
    ports:
      #- 53:53/udp
      #- 53:53/tcp
      - 67:67/udp
      #- 68:68/udp
      - 10000:10000/tcp
    cap_add:
        - NET_ADMIN
  #   hostname: dhcpdns
    image: 'mayankt/dhcpdns:latest'
#
####################################################
#                                                  #
#                -------DockGE-------              #
#                                                  #
####################################################
#
  dockge:
    container_name: dockge
    restart: $RESTART_POLICY
    hostname: dockge
    environment:
      - DOCKER_HOST=$DOCKER_HOST #$SOCKET
      - DOCKGE_STACKS_DIR=$PERSIST/dockge/stacks
    volumes:
      # - $DOCKER_SOCKET:/var/run/docker.sock
      - $PERSIST/dockge/data:/app/data
      - $PERSIST/dockge/stacks:$PERSIST/dockge/stacks #(Both paths match)
    ports:
      - 6001:5001
    networks:
      my_bridge:
    image: 'louislam/dockge:1'
#
####################################################
#                                                  #
#                 -------Doku-------               #
#                                                  #
####################################################
#
  doku:
    container_name: doku
    restart: $RESTART_POLICY
    hostname: doku
    environment:
        - DOCKER_HOST=$DOCKER_HOST
    volumes:
        # - $DOCKER_SOCKET:/var/run/docker.sock:ro
        - /:/hostroot:ro
    ports:
        - 9090:9090
    # networks:
    #   my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    image: 'amerkurev/doku:latest'
#
####################################################
#                                                  #
#              -------DuckDNS-------               #
#                                                  #
####################################################
#
  duckdns:
    container_name: duckdns
    restart: $ALWAYS_ON_POLICY
    hostname: duckdns
    environment:
      - DUCKDNS_DOMAIN=$DOMAINNAME 
      - DUCKDNS_TOKEN=$DUCKTOKEN 
      - DUCKDNS_DELAY=5
      - TZ=$TZ
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    image: 'maksimstojkovic/duckdns:latest'
#
#
####################################################
#                                                  #
#                  -------Dufs-------              #
#                                                  #
####################################################
#
  dufs:
    container_name: dufs
    restart: $RESTART_POLICY
    hostname: dufs
    volumes:
      - $PERSIST/dufs:/data
    networks:
      my_bridge:
    ports:
      - 4688:5000
    command: /data -A
    tty: true
    image: 'sigoden/dufs:latest'
#
####################################################
#                                                  #
#                -------Emby-------                #
#                                                  #
####################################################
#
# sudo chown emby $PERSIST/emby/backup/
# sudo chown emby $PERSIST/emby/config/
#
#
  emby:
    container_name: emby
    restart: $ALWAYS_ON_POLICY
    hostname: emby
    environment:
      - UID=1028
      - GID=2
      - TZ=$TZ
    volumes:
      - $PERSIST/emby/config:/config:rw
      - $PERSIST/emby/backup:/backup:rw
      - $MEDIA_PATH:/media:rw
      # - /dev/shm:/data/transcode
    ports:
      - 0.0.0.0::1900/udp
      - 0.0.0.0::7359/udp
      - 8096:8096/tcp
      - 2096:8920/tcp #cloudflare supported https port https://developers.cloudflare.com/fundamentals/get-started/reference/network-ports/
    networks:
      my_bridge:
    # devices:
    #   - /dev/dri:/dev/dri # for hardware transcoding
    labels: 
      monocker.enable: $MONOCKER_ENABLE
    logging:
      driver: loki
      options:
        loki-url: "http://$LOCAL_HOST:3002/loki/api/v1/push"
    image: 'emby/embyserver:latest'
#
####################################################
#                                                  #
#              -------EmbyStat-------              #
#                                                  #
####################################################
#
# API Key: (Jellyfin)
# 4ccadfd28e4d4cc382362cbd12798055
#
# API Key: (Emby)
# d89469466d924267b9113e8456b1dff1
#
#
  embystat:
    container_name: embystat
    restart: $RESTART_POLICY
    hostname: embystat
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
    volumes:
      - $PERSIST/embystat:/app/config
    ports:
      - 6555:6555
    networks:
      my_bridge:
    image: 'uping/embystat:beta-linux-x64'
#
####################################################
#                                                  #
#               -------Fail2Ban-------             #
#                                                  #
####################################################
#
# https://github.com/sosandroid/docker-fail2ban-synology
#
  fail2ban:
    container_name: fail2ban
    restart: $RESTART_POLICY
    hostname: fail2ban
    environment: 
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
      - F2B_DB_PURGE_AGE=30d
      - F2B_LOG_TARGET=/data/fail2ban.log
      - F2B_LOG_LEVEL=INFO
      - F2B_IPTABLES_CHAIN=INPUT
      # - SSMTP_HOST=$GM_HOST
      # - SSMTP_PORT=$GM_PORT
      # - SSMTP_HOSTNAME=pop.gmail.com
      # - SSMTP_USER=$GM_USER
      # - SSMTP_PASSWORD=$GM_PSW
      # - SSMTP_TLS=NO
      # - SSMTP_STARTTLS=NO
    volumes:
      - $PERSIST/fail2ban:/data
      - $PERSIST/authelia/config:/var/log/authelia:ro
      - $PERSIST/vaultwarden/vaultwarden.log:/var/log/vaultwarden/vaultwarden.log:ro
      - $PERSIST/data/navidrome/navidrome.log:/var/log/navidrome/navidrome.log:ro
    # networks:
    #   my_bridge:
    network_mode: host
    privileged: true
    cap_add:
      - NET_ADMIN
      - NET_RAW
    # logging:
    #   driver: loki
    #   options:
    #     loki-url: "http://$LOCAL_HOST:3002/loki/api/v1/push"
    image: 'crazymax/fail2ban:latest'
#
####################################################
#                                                  #
#               -------FlatNotes-------            #
#                                                  #
####################################################
#
  flatnotes:
    container_name: flatnotes
    restart: $RESTART_POLICY
    hostname: flatnotes
    environment:
      PUID: $PUID
      PGID: $PGID
      FLATNOTES_AUTH_TYPE: "password"
      FLATNOTES_USERNAME: "tam"
      FLATNOTES_PASSWORD: "$DB_PASSWORD"
      FLATNOTES_SECRET_KEY: "$APP_KEY"
    volumes:
      - $PERSIST/flatnotes/data:/data
      - $PERSIST/flatnotes/index:/data/.flatnotes # Optional. Allows you to save the search index in a different location: 
    ports:
      - 8053:8080
    networks:
      my_bridge:
    image: 'dullage/flatnotes:latest'
#
####################################################
#                                                  #
#               -------Forgejo-------              #
#                                                  #
####################################################
#
# https://forgejo.org/docs/latest/admin/installation-docker/ 
#
  forgejo:
    container_name: forgejo
    restart: $RESTART_POLICY
    hostname: forgejo
    environment:
      - USER_UID=$PUID
      - USER_GID=$PGID
    networks:
      my_bridge:
    volumes:
      - $PERSIST/forgejo:/data
      - $TIME_ZONE:/etc/TZ:ro
      - $LOCAL_TIME:/etc/localtime:ro
    ports:
      - 3332:3000
      - 223:22
    image: 'codeberg.org/forgejo/forgejo:1.21'
#
####################################################
#                                                  #
#             -------Glances-------                #
#                                                  #
####################################################
#
  glances:
    container_name: glances
    restart: $RESTART_POLICY
    hostname: glances
    environment:
      - TZ=$TZ
      - GLANCES_OPT=--webserver
    volumes:
      - $DOCKER_SOCKET:/var/run/docker.sock:ro
      - $PERSIST/glances:/glances/conf
    pid: host
    ports:
      - 61208:61208
    image: 'joweisberg/glances:latest'
#
####################################################
#                                                  #
#             -------GoAccess-------               #
#                                                  #
####################################################
#
  goaccess:
    container_name: goaccess
    restart: $RESTART_POLICY
    hostname: goaccess
    environment:
        - PUID=$PUID
        - PGID=$PGID
        - TZ=$TZ
        - BASIC_AUTH=true
        - BASIC_AUTH_USERNAME=tam
        - BASIC_AUTH_PASSWORD=$DB_PASSWORD
    volumes:
        - $PERSIST/nginx-proxy/logs:/opt/log
    ports:
        - 7880:7880
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    image: 'xavierh/goaccess-for-nginxproxymanager:latest'
#
####################################################
#                                                  #
#              -------Home-Panel-------            #
#                                                  #
####################################################
#
  homepanel:
    container_name: homepanel
    restart: $RESTART_POLICY
    hostname: homepanel
    volumes:
      - $PERSIST/homepanel/data:/data
    ports:
      - 8234:8234
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    image: 'timmo001/home-panel:latest'
#
####################################################
#                                                  #
#               -------IT-Tools-------             #
#                                                  #
####################################################
#
  it-tools:
    container_name: it-tools
    restart: $RESTART_POLICY
    hostname: it-tools
    networks:
      my_bridge:
    ports:
      - 5545:80
    image: 'corentinth/it-tools:latest'
#
####################################################
#                                                  #
#              -------Jellyseerr-------            #
#                                                  #
####################################################
#
  jellyseerr:
    container_name: jellyseerr
    restart: $RESTART_POLICY
    hostname: jellyseerr
    environment:
        - LOG_LEVEL=debug
        - TZ=$TZ
    ports:
        - 6556:5055
    networks:
      my_bridge:
    volumes:
        - $PERSIST/jellyseerr:/app/config
    image: 'fallenbagel/jellyseerr:latest'
#
####################################################
#                                                  #
#               -------Joplin-------               #
#                                                  #
####################################################
#
# The default email is admin@localhost and the default password is admin
#
  joplin:
    container_name: joplin
    restart: $RESTART_POLICY
    hostname: joplin
    environment:
        - APP_PORT=2230
        - APP_BASE_URL=https://joplin.$DOMAINNAME/
        - DB_CLIENT=pg
        - POSTGRES_PASSWORD=$DB_PASSWORD
        - POSTGRES_DATABASE=joplindb
        - POSTGRES_USER=joplin
        - POSTGRES_PORT=5432
        - POSTGRES_HOST=joplindb
    ports:
        - 2230:2230
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    depends_on:
        - joplindb
    image: 'joplin/server:latest'
#
####################################################
#                                                  #
#              -------JoplinDB-------              #
#                                                  #
####################################################
#
  joplindb:
    container_name: joplindb
    restart: $RESTART_POLICY
    hostname: joplindb
    environment:
        - POSTGRES_PASSWORD=$DB_PASSWORD
        - POSTGRES_USER=joplin
        - POSTGRES_DB=joplindb
    volumes:
        - $PERSIST/joplin:/var/lib/postgresql/data
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART          
    image: 'postgres:13.1'
#
####################################################
#                                                  #
#               -------KanBoard-------             #
#                                                  #
####################################################
#
  kanboard:
    container_name: kanboard
    restart: $RESTART_POLICY
    hostname: kanboard
    volumes:
      - $PERSIST/kanboard/data:/var/www/app/data
      - $PERSIST/kanboard/plugins:/var/www/app/plugins
      - $PERSIST/kanboard/ssl:/etc/nginx/ssl
    # environment:
    #   DATABASE_URL: mysql://kanboard:$DB_PASSWORD@db/kanboard
    networks:
      my_bridge:
    ports:
      - 4480:80
      - 4443:443
    image: 'kanboard/kanboard:latest'
#
####################################################
#                                                  #
#                 -------Kea-------                #
#                                                  #
####################################################
#
# migrating to pfsense
# /usr/local/etc/kea/kea-dhcp4.conf
# insert under the "subnet4" section
#
# Don't edit the file directly
# Try to go to  Diagnostics > Backup/Restore
# Create a backup file
# Edit the backup file 
# Restore the edited back up file
#
#
# ##If you have the original lease database files you can just stop the DHCP daemon(s) and copy the files into /var/dhcp/var/db/ then start the daemons again.
# 
#
  kea:
    container_name: kea-dhcp4
    restart: $ALWAYS_ON_POLICY
    hostname: kea
    network_mode: host
    command: -c /kea/config/dhcp4.json
    volumes:
      - $PERSIST/kea/config:/kea/config
      - $PERSIST/kea/sockets:/kea/sockets
      - $PERSIST/kea/leases:/kea/leases
      - $PERSIST/kea/logs:/kea/logs
    labels: 
      monocker.enable: $MONOCKER_ENABLE
    image: 'jonasal/kea-dhcp4:2' # do not use the alpine as it does not support routing to Adguard
#
####################################################
#                                                  #
#          -------Let's Encrypt-------             #
#                                                  #
####################################################
#
  letsencrypt:
    container_name: letsencrypt
    restart: $ALWAYS_ON_POLICY
    hostname: letsencrypt
    volumes:
      #- $PERSIST/homeassistant/config/ssl:/etc/letsencrypt:rw
      - $PERSIST/homeassistant/ssl:/etc/letsencrypt:rw
    environment:
      - DUCKDNS_DOMAIN=$DOMAINNAME
      - DUCKDNS_TOKEN=$DUCKTOKEN
      - LETSENCRYPT_EMAIL=$GM_USER
      - LETSENCRYPT_DOMAIN=$DOMAINNAME
      - LETSENCRYPT_WILDCARD=ture
      - TZ=$TZ
    networks:
      my_bridge:
    # logging:
    #   driver: loki
    #   options:
    #     loki-url: "http://$LOCAL_HOST:3002/loki/api/v1/push"
    image: 'maksimstojkovic/letsencrypt:latest'
#
####################################################
#                                                  #
#            -------LibreTranslate-------          #
#                                                  #
####################################################
#
  libretranslate:
    container_name: libretranslate
    restart: $RESTART_POLICY
    hostname: libretranslate
    environment:
      LT_LOAD_ONLY: en,ar #,de,zh,it,es,fr,pl,tr,ru,fi,nl,id,cs,el,hu,sk
      # LT_API_KEYS: true
      # LT_API_KEYS_DB_PATH: /app/db/api_keys.db # Same result as `db/api_keys.db` or `./db/api_keys.db`
      # LT_UPDATE_MODELS: true
    # volumes:
    #   - $PERSIST/libretranslate/db:/app/db
    #   - $PERSIST/libretranslate/models:/home/libretranslate/.local:rw
    healthcheck:
      test: ['CMD-SHELL', './venv/bin/python scripts/healthcheck.py']
    security_opt:
      - no-new-privileges:true
    ports:
      - 7821:5000
    networks: 
      my_bridge:
    image: 'libretranslate/libretranslate:latest'
#
####################################################
#                                                  #
#                -------LibreX-------              #
#                                                  #
####################################################
#
  librex:
    container_name: librex
    restart: $ALWAYS_ON_POLICY
    hostname: librex
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - VERSION=docker
      - TZ=$TZ
      - CONFIG_GOOGLE_DOMAIN=com
      - CONFIG_GOOGLE_LANGUAGE_SITE=en
      - CONFIG_GOOGLE_LANGUAGE_RESULTS=en
      - CONFIG_WIKIPEDIA_LANGUAGE=en
    volumes:
      - $PERSIST/librex/nginx:/var/log/nginx
      - $PERSIST/librex/logs:/var/log/php7
    ports:
      - 8245:8080
    networks:
      my_bridge:
    image: 'librex/librex:latest'
#
####################################################
#                                                  #
#               -------Lingva-------               #
#                                                  #
####################################################
#
  lingva:
    container_name: lingva
    restart: $RESTART_POLICY
    hostname: lingva
    environment:
      site_domain: translate.$DOMAINNAME
      force_default_theme: dark
      default_source_lang: auto
      default_target_lang: en
    ports:
      - 6455:3000
    networks:
      my_bridge: 
    security_opt:
      - no-new-privileges:true
    image: 'thedaviddelta/lingva-translate:latest'
#
####################################################
#                                                  #
#                 -------Memos-------              #
#                                                  #
####################################################
#
  memos:
    container_name: memos
    restart: $RESTART_POLICY
    hostname: memos
    volumes:
      - $PERSIST/memos:/var/opt/memos
    ports:
      - 5230:5230
    networks:
      my_bridge:
    labels: 
      # autoheal: $AUTOHEAL_RESTART
      monocker.enable: $MONOCKER_ENABLE
    # logging:
    #   driver: loki
    #   options:
    #     loki-url: "http://$LOCAL_HOST:3002/loki/api/v1/push"
    image: 'neosmemo/memos:latest'
#
####################################################
#                                                  #
#             -------Middle Finger-------          #
#                                                  #
####################################################
#
  middlefinger:
    container_name: middlefinger
    restart: $ALWAYS_ON_POLICY
    hostname: middlefinger
    ports:
      - 404:8080
    networks:
      my_bridge:
    # logging:
    #   driver: loki
    #   options:
    #     loki-url: "http://$LOCAL_HOST:3002/loki/api/v1/push"
    image: 'modem7/middle-finger:dual'
#
####################################################
#                                                  #
#             -------Node-Exporter-------          #
#                                                  #
####################################################
#
# for Prometheus
#
  node-exporter:
    container_name: node-exporter
    restart: $RESTART_POLICY
    hostname: node-exporter
    privileged: true
    ports:
        - 9100:9100
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    image: 'prom/node-exporter:latest'
#
####################################################
#                                                  #
#              -------Node-RED-------              #
#                                                  #
####################################################
#
  nodered:
    container_name: nodered
    restart: $RESTART_POLICY
    hostname: nodered
    environment:
      - TZ=$TZ
    volumes:
      - $PERSIST/nodered:/data
    ports:
      - 1880:1880/tcp
    #network_mode: "host"
    healthcheck:
      test: curl -fSs http://127.0.0.1:1880 || exit 1
      start_period: 90s
      timeout: 10s
      interval: 5s
      retries: 3    
    networks:
      my_bridge:
    working_dir: /usr/src/node-red
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
      - autoheal=$AUTOHEAL_RESTART
    image: 'nodered/node-red:latest'
#
####################################################
#                                                  #
#        -------Nginx Proxy Manager-------         #
#                                                  #
####################################################
#
# convert the sqlite v3 file to mysql format using https://www.rebasedata.com/convert-sqlite-to-mysql-online
# to migrate from local sqlite to MariaDB, execute the below command:
# sudo docker exec -i [container_name] mysql --user=[User] --password=[Password] -h[Host] [db_name]<[mysql_file]
#   [container_name]=mariadb
#   [User]=npm
#   [Password]=1234ABCD
#   [Host]=192.168.1.10 
#   [db_name]=npmdb
#   [mysql_file]=data.sql
#
  npm:
    container_name: nginx-proxy-manager
    restart: $ALWAYS_ON_POLICY
    hostname: nginx-proxy-manager
    environment:
      PUID: $PUID
      PGID: $PGID
      TZ: $TZ
    #  DB_SQLITE_FILE: "/data/database.sqlite"
      DB_MYSQL_HOST: 'mariadb'
      DB_MYSQL_PORT: 3306
      DB_MYSQL_USER: 'npm'
      DB_MYSQL_PASSWORD: '$DB_PASSWORD'
      DB_MYSQL_NAME: 'npmdb'
      DISABLE_IPV6: 'true'
    volumes:
      - $PERSIST/nginx-proxy/letsencrypt:/etc/letsencrypt:rw
      - $PERSIST/nginx-proxy:/data:rw
    ports:
      - 880:80 
      - 881:81
      - 843:443
    networks:
      my_bridge:
    depends_on:
        mariadb:
          condition: service_healthy
    logging:
      driver: loki
      options:
        loki-url: "http://$LOCAL_HOST:3002/loki/api/v1/push"
    image: 'jc21/nginx-proxy-manager:latest'
#
####################################################
#                                                  #
#          -------Our Shopping List-------         #
#                                                  #
####################################################
#
  osl:
    container_name: osl
    restart: $ALWAYS_ON_POLICY
    hostname: osl
    environment:
      # Default values below
      LISTEN_PORT: 8080
      MONGODB_HOST: osldb
      MONGODB_PORT: 27017
      MONGODB_DB: osl
      VUE_APP_I18N_LOCALE: en
      VUE_APP_I18N_FALLBACK_LOCALE: en
      VUE_APP_I18N_FORCE_LOCALE: 0
      VUE_APP_SINGLEBOARD_MODE: 0
    ports:
      - 8989:8080
    networks:
      my_bridge:
    depends_on:
      - osldb
    image: 'nanawel/our-shopping-list:latest'
#
####################################################
#                                                  #
#         -------Our Shopping List-DB------        #
#                                                  #
####################################################
#
# chown 999:users mongodb/
#
  osldb:
    container_name: osldb
    restart: $ALWAYS_ON_POLICY
    hostname: osldb
    volumes:
      - $PERSIST/mongodb/shoppinglist:/data/db
    ports:
      - 27017:27017
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    image: 'mongo:4.0'
#
####################################################
#                                                  #
#              -------Ouroboros-------             #
#                                                  #
####################################################
#
# https://github.com/pyouroboros/ouroboros/wiki/Usage
#
  ouroboros:
    container_name: ouroboros
    restart: $RESTART_POLICY
    hostname: ouroboros
    environment:
      - CLEANUP=true
      - LOG_LEVEL=info
      - CRON="0/15 1 * * *" #At every 15th minute from 0 through 59 past 1am
      - LATEST=true
      - SELF_UPDATE=true
      - SKIP_STARTUP_NOTIFICATIONS=true 
      - NOTIFIERS="pover://uf3foyf32w8pi6gfzamwo2tfay99cr@a9peo818h7jrwd2yvvkpxu5kqubgc3"
      #- IGNORE=esphome homeassistant
      - TZ=$TZ
    volumes:
      - $DOCKER_SOCKET:/var/run/docker.sock:rw
    networks:
      my_bridge:
    working_dir: /app
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    image: 'pyouroboros/ouroboros:latest'
#
####################################################
#                                                  #
#             -------phpMyAdmin-------             #
#                                                  #
####################################################
#
# TO ACCESS MariaDB via phpMyAdmin, use the below command in putty to check the PMA_HOST address
# docker inspect mariadb | grep IPAddress
#
  phpmyadmin:
    container_name: phpmyadmin
    restart: $RESTART_POLICY
    hostname: phpmyadmin
    environment:
      - PMA_HOST=mariadb #172.18.0.8 #mariadb ip address
      - PMA_USER=root
      - PMA_PASSWORD=$DB_PASSWORD
      - TZ=$TZ
    volumes:
       - $LOCAL_TIME:/etc/localtime:ro
    ports:
      - 3300:80 
    networks:
      my_bridge:
    depends_on:
      - mariadb
    tty: true
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    image: 'phpmyadmin/phpmyadmin:latest'
#
####################################################
#                                                  #
#                -------Phlare-------              #
#                                                  #
####################################################
#
  phlare:
    container_name: phlare
    restart: $RESTART_POLICY
    hostname: phlare
    volumes:
        - $PERSIST/phlare/config.yaml:/etc/phlare/config.yaml'
    ports:
        - 4100:4100
    networks:
      my_bridge:
    command: --config.file=/etc/phlare/config.yaml
    image: 'grafana/phlare:latest'
#
####################################################
#                                                  #
#              -------Photoprism-------            #
#                                                  #
####################################################
#
  photoprism:
    container_name: photoprism
    restart: $RESTART_POLICY
    hostname: photoprism
    security_opt:
      - seccomp:unconfined
      - apparmor:unconfined
    user: $PUID:$PGID
    healthcheck:
      test: wget --no-verbose --tries=1 --spider http://localhost:2342
    ports:
      - 2342:2342        
    volumes:
      - $PERSIST/photoprism/import:/photoprism/import:rw       # *Optional* base folder from which files can be imported to originals    
      - $PERSIST/photoprism/storage:/photoprism/storage:rw
      - $MEDIA_PATH/Photos:/photoprism/originals:rw
#     - /volume1/docker/photoprism/family:/photoprism/originals/family:rw               # *Additional* media folders can be mounted like this
    environment:
      PHOTOPRISM_ADMIN_USER: tam
      PHOTOPRISM_ADMIN_PASSWORD: ts*JhcmL&5zc^5
      PHOTOPRISM_UID: $PUID
      PHOTOPRISM_GID: $PGID
      PHOTOPRISM_AUTH_MODE: password
      PHOTOPRISM_SITE_URL: http://localhost:2342/
      PHOTOPRISM_ORIGINALS_LIMIT: 5120
      PHOTOPRISM_HTTP_COMPRESSION: gzip
      PHOTOPRISM_READONLY: false
      PHOTOPRISM_EXPERIMENTAL: false
      PHOTOPRISM_DISABLE_CHOWN: false
      PHOTOPRISM_DISABLE_WEBDAV: false
      PHOTOPRISM_DISABLE_SETTINGS: false
      PHOTOPRISM_DISABLE_TENSORFLOW: false
      PHOTOPRISM_DISABLE_FACES: false
      PHOTOPRISM_DISABLE_CLASSIFICATION: false
      PHOTOPRISM_DISABLE_RAW: true
      PHOTOPRISM_RAW_PRESETS: false
      PHOTOPRISM_DISABLE_DARKTABLE: true
      PHOTOPRISM_DISABLE_RAWTHERAPEE: true
      PHOTOPRISM_DISABLE_IMAGEMAGICK: true
      PHOTOPRISM_DISABLE_HEIFCONVERT: true
      PHOTOPRISM_DISABLE_RSVGCONVERT: true
      PHOTOPRISM_JPEG_QUALITY: 100
      PHOTOPRISM_DETECT_NSFW: false
      PHOTOPRISM_UPLOAD_NSFW: true
      PHOTOPRISM_SPONSOR: true
      PHOTOPRISM_DATABASE_DRIVER: mysql
      PHOTOPRISM_DATABASE_SERVER: mariadb:3306
      PHOTOPRISM_DATABASE_NAME: photoprism
      PHOTOPRISM_DATABASE_USER: photoprism
      PHOTOPRISM_DATABASE_PASSWORD: $DB_PASSWORD
      PHOTOPRISM_WORKERS: 2
      PHOTOPRISM_THUMB_FILTER: blackman       # best to worst: blackman, lanczos, cubic, linear
      PHOTOPRISM_APP_MODE: standalone         # progressive web app MODE - fullscreen, standalone, minimal-ui, browser
#     PHOTOPRISM_SITE_CAPTION: "AI-Powered Photos App"
#     PHOTOPRISM_SITE_DESCRIPTION: ""
#     PHOTOPRISM_SITE_AUTHOR: ""
    working_dir: "/photoprism"
    networks:
      my_bridge:
    depends_on:
      mariadb:
        condition: service_started
    image: 'photoprism/photoprism:latest'
#
####################################################
#                                                  #
#              -------Photoview-------             #
#                                                  #
####################################################
#
  photoview:
    container_name: photoview
    restart: $RESTART_POLICY
    hostname: photoview
    environment:
      PHOTOVIEW_DATABASE_DRIVER: postgres
      PHOTOVIEW_POSTGRES_URL: postgresql://photoview:photoview@photoview-postgress:5432/photoview
      PHOTOVIEW_LISTEN_PORT: 4000
      PHOTOVIEW_MEDIA_CACHE: /app/cache
    volumes:
      - $PERSIST/photoview/cache:/app/cache:rw
      - $MEDIA_PATH/Photos:/photos:ro
      # - /path_to_photos:/photos2:ro
    ports:
      - 7354:4000
    networks:
      my_bridge:
    security_opt:
      - no-new-privileges:true
    read_only: true
    user: $PUID:$PGID
    healthcheck:
      test: curl -f http://localhost:4000/ || exit 1
    depends_on:
      photoview-postgress:
        condition: service_healthy
    image: 'viktorstrate/photoview:2'
#
####################################################
#                                                  #
#         -------Photoview-Postgress-------        #
#                                                  #
####################################################
#
  photoview-postgress:
    container_name: photoview-postgress
    restart: $RESTART_POLICY
    hostname: photoview-postgress
    environment:
      POSTGRES_DB: photoview
      POSTGRES_USER: photoview
      POSTGRES_PASSWORD: photoview
    volumes:
      - $PERSIST/photoview/db:/var/lib/postgresql/data:rw
    networks:
      my_bridge:  
    security_opt:
      - no-new-privileges:true
    user: $PUID:$PGID
    healthcheck:
      test: ["CMD", "pg_isready", "-q", "-d", "photoview", "-U", "photoview"]
      timeout: 45s
      interval: 10s
      retries: 10
    image: 'postgres:alpine'
#
####################################################
#                                                  #
#               -------PicoShare-------            #
#                                                  #
####################################################
#
  picoshare:
    container_name: picoshare
    restart: $RESTART_POLICY
    hostname: picoshare
    environment:
      - PORT=3001
      - PS_SHARED_SECRET=$PASSWD # Change to any password
    volumes:
      - $PERSIST/picoshare:/data
    ports:
      - 8179:3001
    networks:
      my_bridge:
    # logging:
    #   driver: loki
    #   options:
    #     loki-url: "http://$LOCAL_HOST:3002/loki/api/v1/push"
    command: -db /data/store.db -vacuum true
    image: 'mtlynch/picoshare:latest'
#
####################################################
#                                                  #
#              -------Pigallery-------             #
#                                                  #
####################################################
#
  pigallery:
    container_name: pigallery
    hostname: pigallery
    restart: $RESTART_POLICY
    environment:
      NODE_ENV: production
      PORT: 8080
    volumes:
      - $PERSIST/pigallery/db:/app/data/db:rw
      - $PERSIST/pigallery/config:/app/data/config:rw
      - $PERSIST/pigallery/tmp:/app/data/tmp:rw
      - $MEDIA_PATH/Photos:/app/data/images:ro  # Point to your photos folder
    ports:
      - 9842:8080
    networks:
      my_bridge:  
    security_opt:
      - no-new-privileges:true
    read_only: true
    user: $PUID:$PGID
    healthcheck:
      test: wget --no-verbose --tries=1 --spider http://localhost:8080
    image: 'bpatrik/pigallery2:latest'
#
# steps
# https://mariushosting.com/how-to-install-piped-on-your-synology-nas/
# config files
# https://github.com/TeamPiped/Piped-Docker/blob/main/template/docker-compose.nginx.yml
#
# https://takeout.google.com/takeout/custom/youtube
#
#
####################################################
#                                                  #
#            -------Piped-Postgres-------          #
#                                                  #
####################################################
#
  piped-postgres:
    container_name: piped-postgres
    hostname: piped-postgres
    restart: $RESTART_POLICY
    volumes:
      - $PERSIST/piped/db:/var/lib/postgresql/data
    environment:
      TZ: $TZ
      POSTGRES_DB: piped
      POSTGRES_USER: piped
      POSTGRES_PASSWORD: $DB_PASSWORD
    networks:
      my_bridge:
    security_opt:
      - no-new-privileges:true
    healthcheck:
      test: ["CMD", "pg_isready", "-q", "-d", "piped", "-U", "piped"]
      timeout: 45s
      interval: 10s
      retries: 10
    labels: 
      autoheal: $AUTOHEAL_RESTART
    user: $PUID:$PGID
    image: 'postgres:alpine'
#
####################################################
#                                                  #
#            -------Piped-Backend-------           #
#                                                  #
####################################################
#
  piped-backend:
    container_name: piped-backend
    hostname: piped-backend
    restart: $RESTART_POLICY
    volumes:
        - $PERSIST/piped/config.properties:/app/config.properties:ro
    networks:
      my_bridge:
    healthcheck:
      test: stat /etc/passwd || exit 1
    labels: 
      autoheal: $AUTOHEAL_RESTART
      monocker.enable: $MONOCKER_ENABLE
    security_opt:
      - no-new-privileges:true
    depends_on:
      piped-postgres:
        condition: service_healthy
    image: '1337kavin/piped:latest'
#
####################################################
#                                                  #
#            -------Piped-Frontend-------          #
#                                                  #
####################################################
#
  piped-frontend:
    container_name: piped-frontend
    hostname: piped-frontend
    restart: $RESTART_POLICY
    networks:
      my_bridge:
    security_opt:
      - no-new-privileges:true
    depends_on:
      piped-backend:
        condition: service_healthy
    entrypoint: ash -c 'sed -i s/pipedapi.kavin.rocks/utubeapi.tamimology.com/g /usr/share/nginx/html/assets/* && /docker-entrypoint.sh && nginx -g "daemon off;"'
    healthcheck:
      test: wget --no-verbose --tries=1 --spider http://localhost:80
    labels: 
      autoheal: $AUTOHEAL_RESTART
      monocker.enable: $MONOCKER_ENABLE
    image: '1337kavin/piped-frontend:latest'
#
####################################################
#                                                  #
#              -------Piped-Nginx-------           #
#                                                  #
####################################################
#
  piped-nginx:
    container_name: piped-nginx
    restart: $RESTART_POLICY
    hostname: piped-nginx
    ports:
      - 7601:80
    networks:
      my_bridge:
    volumes:
      - $PERSIST/piped/proxy:/var/run/ytproxy:rw
      - $PERSIST/piped/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - $PERSIST/piped/nginx/pipedapi.conf:/etc/nginx/conf.d/pipedapi.conf:ro
      - $PERSIST/piped/nginx/pipedproxy.conf:/etc/nginx/conf.d/pipedproxy.conf:ro
      - $PERSIST/piped/nginx/pipedfrontend.conf:/etc/nginx/conf.d/pipedfrontend.conf:ro
      - $PERSIST/piped/nginx/ytproxy.conf:/etc/nginx/snippets/ytproxy.conf:ro
    security_opt:
      - no-new-privileges:true
    healthcheck:
      test: wget --no-verbose --tries=1 --spider http://localhost:80
    labels: 
      autoheal: $AUTOHEAL_RESTART
      monocker.enable: $MONOCKER_ENABLE
    depends_on:
      piped-backend:
        condition: service_healthy
      piped-frontend:
        condition: service_healthy
      piped-proxy:
        condition: service_started
    image: 'nginx:mainline-alpine'
#
####################################################
#                                                  #
#              -------Piped-Proxy-------           #
#                                                  #
####################################################
#
  piped-proxy:
    container_name: piped-proxy
    restart: $RESTART_POLICY
    hostname: piped-proxy
    environment:
      UDS: 1
    volumes:
      - $PERSIST/piped/proxy:/app/socket:rw
    networks:
      my_bridge:
    read_only: true
    security_opt:
      - no-new-privileges:true
    image: '1337kavin/piped-proxy:latest'
#
####################################################
#                                                  #
#                -------Piwigo-------              #
#                                                  #
####################################################
#
# to delete eaDir in sub directories in one command, use reference https://unix.stackexchange.com/questions/89925/how-to-delete-directories-based-on-find-output
# find . -depth -name "@eaDir" -type d -exec rm -rf {} +
#
  piwigo:
    container_name: piwigo
    restart: $RESTART_POLICY
    hostname: piwigo
    volumes:
      - $PERSIST/piwigo/config:/config
      - $MEDIA_PATH/Photos:/gallery
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
    healthcheck:
      test: curl -fSs http://127.0.0.1:80 || exit 1
      start_period: 120s
      timeout: 10s
      interval: 5s
      retries: 3
    ports:
      - 8100:80
    networks:
      my_bridge:
    depends_on:
      - mariadb
    image: 'ghcr.io/linuxserver/piwigo:latest'
#
####################################################
#                                                  #
#              -------Piwigo-DB-------             #
#                                                  #
####################################################
#
  piwigodb:
    container_name: piwigo-db
    restart: $RESTART_POLICY
    hostname: piwigodb
    volumes:
      - $PERSIST/piwigo/db:/config
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
      - MYSQL_ROOT_PASSWORD=piwigo
      - MYSQL_DATABASE=piwigo
      - MYSQL_USER=piwigo
      - MYSQL_PASSWORD=$DB_PASSWORD
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "--silent"]
    expose: 
      - 3306
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
      - autoheal
    image: 'vcxpz/mariadb:latest'
#
####################################################
#                                                  #
#        -------Piwigo-MariaDB-Backup-------       #
#                                                  #
####################################################
#
# used for piwigo db in container
#
  piwigo-mariadb-backup:
    container_name: piwigo-mariadb-backup
    restart: $RESTART_POLICY
    hostname: piwigo-mariadb-backup
    volumes:
      - $BACKUPS/mariadb/piwigo:/backup
      #- ./post-script.sh:/assets/custom-scripts/post-script.sh
    environment:
      - TIMEZONE=$TZ
      - DB_TYPE=mariadb
      - DB_HOST=piwigodb
      - DB_PORT=3306
      - DB_NAME=piwigo
      - DB_USER=piwigo
      - DB_PASS=$DB_PASSWORD
      - DB_DUMP_FREQ=1440 #once per day
      - DB_DUMP_BEGIN=0030 # @00:30 midnight
      - DB_CLEANUP_TIME=8640 # keep for 6 days
      - CHECKSUM=SHA1
      - COMPRESSION=ZSTD
      - COMPRESSION_LEVEL=10
      - SPLIT_DB=FALSE
      - MYSQL_SINGLE_TRANSACTION=true
      - CONTAINER_ENABLE_MONITORING=FALSE
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    links:
     - piwigodb
    image: 'tiredofit/db-backup:latest'
#
####################################################
#                                                  #
#              -------Prometheus-------            #
#                                                  #
####################################################
#
  prometheus:
    container_name: prometheus
    restart: $RESTART_POLICY
    hostname: prometheus
    volumes:
      - $PERSIST/prometheus/data:/prometheus
      - $PERSIST/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
    depends_on:
        - cadvisor
    ports:
      - 9090:9090
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    user: root
    command: "--config.file=/etc/prometheus/prometheus.yml --storage.tsdb.path=/prometheus"
    image: 'prom/prometheus:latest'  
#
####################################################
#                                                  #
#                -------Plex-------                #
#                                                  #
####################################################
#
  plex:
    container_name: plex
    restart: $RESTART_POLICY
    hostname: plex
    environment:
      - PLEX_CLAIM=$PLEX_CLAIM_TOKEN
      - PLEX_GID=$PGID
      - PLEX_UID=$PUID
      - TZ=$TZ
    volumes:
      - $PERSIST/plex/config:/config:rw
      - $PERSIST/plex/transcode:/transcode:rw
      - $PERSIST/plex/data:/data:rw
      - $MEDIA_PATH:/media:rw
    healthcheck:
      test: curl -fsS http://localhost:32400/identity > /dev/null || exit 1
      start_period: 60s
      timeout: 10s
      interval: 5s
      retries: 3
    #network_mode: "host"
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
      - autoheal=$AUTOHEAL_RESTART
    image: 'plexinc/pms-docker:latest'
#
####################################################
#                                                  #
#            -------Portainer-CE-------            #
#                                                  #
####################################################
#
  portainer:
    container_name: portainer-ce
    restart: $ALWAYS_ON_POLICY
    hostname: portainer
    privileged: true
    command: -H $DOCKER_HOST --tlsskipverify
    environment:
      DOCKER_HOST: $SOCKET
    volumes:
      - $DOCKER_SOCKET:/var/run/docker.sock
      - $PERSIST/portainer:/data
    ports:
      - 8000:8000/tcp
      - 9000:9000/tcp
      - 9443:9443/tcp
    networks:
      my_bridge:
    # logging:
    #   driver: loki
    #   options:
    #     loki-url: "http://$LOCAL_HOST:3002/loki/api/v1/push"
    image: 'portainer/portainer-ce:alpine'
#
####################################################
#                                                  #
#               -------Reiverr-------              #
#                                                  #
####################################################
#
  reiverr:
    container_name: reiverr
    restart: $RESTART_POLICY
    hostname: reiverr
    volumes:
      - $PERSIST/reiverr:/config
    ports:
      - 9494:9494
    networks:
      my_bridge:
    image: 'ghcr.io/aleksilassila/reiverr:latest'
#
####################################################
#                                                  #
#               -------SearXNG-------              #
#                                                  #
####################################################
#
  searxng:
    container_name: searxng
    restart: $ALWAYS_ON_POLICY
    hostname: searxng
    environment:
      - SEARXNG_BASE_URL=https://search.$DOMAINNAME/
    volumes:
      - $PERSIST/searxng:/etc/searxng:rw
    ports:
     - 5080:8080
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
      - DAC_OVERRIDE
    logging:
      driver: "json-file"
      options:
        max-size: "1m"
        max-file: "1"
    image: 'searxng/searxng:latest'
#
####################################################
#                                                  #
#                -------Shiori-------              #
#                                                  #
####################################################
#
# https://github.com/Peppershade/shiori
# Chrome Web Extension
# https://chrome.google.com/webstore/detail/shiori-create-bookmarks-e/admfbhjcnlacjbodldopmpjplnobgcje
# Firefox Plugin
# https://github.com/go-shiori/shiori-web-ext
# 
# username: shiori
# password: gopher
#
# https://github.com/go-shiori/shiori/blob/master/docs/Usage.md#using-command-line-interface
# to import from Chrome, export to Netscape HTML format, copy the file into SHIORI mounted folder, SSH into container and execute the following
# shiori import bookmarks_XX_XX_XXXX.html
#
# if database is readonly, exceute the following in host server
# sudo chown 1000:1000 shiori
#
  shiori:
    container_name: shiori
    restart: $RESTART_POLICY
    hostname: shiori
    environment:
      - SHIORI_HTTP_SECRET_KEY=$APP_KEY
      - PUID=1000
      - PGID=1000
      # - SHIORI_DIR=/data
    ports:
        - 18080:8080
    networks:
      my_bridge:
    volumes:
        # - $PERSIST/shiori:/shiori-data
        - $PERSIST/shiori:/shiori
    image: 'ghcr.io/go-shiori/shiori:latest' #'peppershade/shiori:latest'
#
####################################################
#                                                  #
#               -------SnipeIT-------              #
#                                                  #
####################################################
#
# https://snipe-it.readme.io/docs/docker
#
  snipeit:
    image: 'snipe/snipe-it:latest-alpine' #https://hub.docker.com/r/snipe/snipe-it/
    container_name: snipeit
    restart: on-failure:5
    healthcheck:
      test: curl -f http://localhost:80/ || exit 1
    depends_on:
      - mariadb
    networks:
      my_bridge:
    volumes:
      - $PERSIST/snipeit:/config:rw
    environment:
      - TZ=$TZ
      - APP_URL=http://192.168.1.10:1339
      - APP_KEY=base64:jtww95XJZi2u97Nou8a9SMI2CZg6BOvfdUc7yF9y4bw=
      - MYSQL_PORT_3306_TCP_ADDR=mariadb
      - MYSQL_PORT_3306_TCP_PORT=3306
      - MYSQL_DATABASE=snipe
      - MYSQL_USER=snipe
      - MYSQL_PASSWORD=snipe
      - PGID=$PGID
      - PUID=$PUID
      - MAIL_PORT_587_TCP_ADDR=$GM_HOST
      - MAIL_PORT_587_TCP_PORT=$GM_PORT
      - MAIL_ENV_FROM_ADDR=$GM_USER
      - MAIL_ENV_FROM_NAME=Tamimology Server
      - MAIL_ENV_ENCRYPTION=SSL
      - MAIL_ENV_USERNAME=$GM_USER
      - MAIL_ENV_PASSWORD=$GM_PSW
    ports:
      - 1339:80
#
####################################################
#                                                  #
#           -------TLS-Socket-Proxy-------         #
#                                                  #
####################################################
#
# https://www.smarthomebeginner.com/traefik-docker-security-best-practices/#9_Use_a_Docker_Socket_Proxy
#
# to test connectivity, run the below in SSH
# docker -H tcp://192.168.1.10:2376 --tlsverify --tlscacert=ca.pem --tlscert=cert.pem --tlskey=key.pem info
#
  dsp:
    container_name: dsp
    restart: $ALWAYS_ON_POLICY
    hostname: dsp
    environment:
      CERTS_DIR: "/server-keys"
    volumes:
      - $PERSIST/socket-proxy/certs:/server-keys:ro #https://docs.docker.com/engine/security/protect-access/
      - $DOCKER_SOCKET:/var/run/docker.sock
    ports:
      - 2376:2376
    command: ["-dd", "-lmlocal2"]
    image: 'sjawhar/docker-socket-proxy:latest'
#
####################################################
#                                                  #
#                -------Vault-------               #
#                                                  #
####################################################
#
  vault:
    restart: on-failure:5
    container_name: vault
    environment:
      VAULT_DEV_LISTEN_ADDRESS: 0.0.0.0:8200
    volumes:
      - $PERSIST/vault/logs:/vault/logs:rw
      - $PERSIST/vault/data:/vault/file:rw
      - $PERSIST/vault/config:/vault/config:rw
      - $PERSIST/vault/plugins:/vault/plugins:rw
      - $LOCAL_TIME:/etc/localtime:ro
    # hostname: vault
    # mem_limit: 512m
    # cpu_shares: 768
    ports:
      - 8205:8200
    networks:
      my_bridge:
    security_opt:
      - no-new-privileges:true
    cap_add:
      - IPC_LOCK
    entrypoint: vault server -config=/vault/config/vault.json
    healthcheck:
      test: wget --no-verbose --tries=1 --spider http://localhost:8200
    image: 'hashicorp/vault:latest'
#
####################################################
#                                                  #
#         -------Visual Studio Code-------         #
#                                                  #
####################################################
#
  vscode:
    container_name: vscode
    restart: $RESTART_POLICY
    hostname: vscode
    environment:
      - PASSWORD=$DB_PASSWORD
    volumes:
      - $PERSIST/vscode:/home/coder/.local/share/code-server:rw
      - $PERSIST/homeassistant:/home/coder/project:rw
    ports:
      - 8181:8080
    networks:
      my_bridge:
    working_dir: /home/coder
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    command: code-server --no-auth # if using proxy add: --allow-http
    image: 'codercom/code-server:latest'
#
####################################################
#                                                  #
#             -------WhatsUpDocker-------          #
#                                                  #
####################################################
#
  whatsupdocker:
    container_name: whatsupdocker
    restart: $RESTART_POLICY
    hostname: whatsupdocker
    environment:
      - DOCKER_HOST=$SOCKET  
      # - TZ=$TZ
      - WUD_TRIGGER_PUSHOVER_1_TOKEN=$PUSHOVER_DOCKER_UPDATES_API
      - WUD_TRIGGER_PUSHOVER_1_USER=$PUSHOVER_USER_KEY
      # - WUD_TRIGGER_PUSHOVER_1_DEVICE=myIphone,mySamsung
      - WUD_WATCHER_LOCAL_CRON=0 10 * * *
    volumes:
    #   - /var/run/docker.sock:/var/run/docker.sock
      - $PERSIST/wud:/store
      - $LOCAL_TIME:/etc/localtime:ro
    healthcheck:
      test: wget --no-verbose --tries=1 --no-check-certificate --spider http://localhost:3000
      interval: 10s
      timeout: 10s
      retries: 3
      start_period: 10s  
    networks:
      my_bridge:
    ports:
      - 3000:3000
    image: 'fmartinou/whats-up-docker:latest'
#
####################################################
#                                                  #
#               -------WebDAV-------               #
#                                                  #
####################################################
#
  webdav:
    container_name: webdav
    restart: $RESTART_POLICY
    hostname: webdav
    environment:
      PUID: $PUID
      PGID: $PGID
      AUTH_TYPE: Digest
      USERNAME: tam
      PASSWORD: ABCD1234
    volumes:
      - $PERSIST/webdav:/var/lib/dav
    ports:
      - 8888:80
    networks:
      my_bridge:
    labels:
      - deunhealth.restart.on.unhealthy=$AUTOHEAL_RESTART
    image: 'bytemark/webdav:latest'
#
####################################################
#                                                  #
#                -------webNUT-------              #
#                                                  #
####################################################
# 
# To get user and password in Synology, use the below
# cd /usr/syno/etc/ups/
# cat upsd.users 
#
# To get device details in Synology, use the below
# cat /dev/bus/usb/devices
#
# reference (it is using an old image with 10x size of below)
# https://www.thesmarthomebook.com/2022/09/02/setting-up-monitor-your-ups-proxmox-home-assistant/
#
# https://networkupstools.org/ddl/Eaton/5E1100iUSB.html
#
  webnut:
    container_name: webnut
    restart: $ALWAYS_ON_POLICY
    hostname: webnut
    environment:
      UPS_HOST: "192.168.1.10"
      UPS_PORT: "3493"
      UPS_USER: "upsadmin"
      UPS_PASSWORD: "secret"
    ports:
     - 6543:6543
    network_mode: host
    image: 'edgd1er/webnut:latest'
#
####################################################
#                                                  #
#           -------Container-WebTTY-------         #
#                                                  #
####################################################
#
  webtty:
    container_name: container-webtty
    restart: $RESTART_POLICY
    hostname: webtty
    environment:
      - DOCKER_HOST=$SOCKET
      # - WEB_TTY_GRPC_PORT=8090
      # - WEB_TTY_GRPC_AUTH=1234ABCD
    volumes:
      - $DOCKER_SOCKET:/var/run/docker.sock
    ports:
      - 8818:8080
    #  - 8090:8090
    networks:
      my_bridge:
    # logging:
    #   driver: loki
    #   options:
    #     loki-url: "http://$LOCAL_HOST:3002/loki/api/v1/push"
    image: 'wrfly/container-web-tty:0.1.10' #latest'
#
####################################################
#                                                  #
#                -------WeTTY-------               #
#                                                  #
####################################################
#
  wetty:
    container_name: wetty
    restart: $RESTART_POLICY
    hostname: wetty
    environment:
      SSHHOST: 192.168.1.10
      SSHPORT: 1234
      SSHUSER: tam
      SSHPASS: $SSHPASS
      NODE_ENV: 'development'
      BASE: /
      VERSION: true
      # COMMAND: 'cd $PERSIST'
      TITLE: 'Tamimology SSH'
    ports:
      - 5800:3000
    networks:
      my_bridge:
        ipv4_address: $BRIDGE_NET.100
    # logging:
    #   driver: loki
    #   options:
    #     loki-url: "http://$LOCAL_HOST:3002/loki/api/v1/push"
    tty: true
    working_dir: /usr/src/app
    image: 'wettyoss/wetty:latest'
#
####################################################
#                                                  #
#              -------xBackbone-------             #
#                                                  #
####################################################
#
  xbackbone:
    container_name: xbackbone
    restart: $RESTART_POLICY
    hostname: xbackbone
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
    volumes:
      - $PERSIST/xbackbone:/config
    ports:
      - 8522:80
      - 4443:443
    networks:
      my_bridge: 
    image: 'lscr.io/linuxserver/xbackbone:latest'
#



